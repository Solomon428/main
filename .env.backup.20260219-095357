# FILE: .env
# ==============================================================================
# CREDITORFLOW EMS - ENVIRONMENT CONFIGURATION
# Version: 2.1.0 | SEE-Certified (Zero Operational Loss)
# ==============================================================================
# SECURITY NOTICE: 
# - ALL secrets MUST be rotated before production deployment
# - NEVER commit this file to version control
# - Use .env.vault or HashiCorp Vault for production secret management
# ==============================================================================

# ------------------------------------------------------------------------------
# DATABASE CONFIGURATION (PostgreSQL + Prisma)
# ------------------------------------------------------------------------------

# Primary Database Connection (Application) - Schema-scoped
DATABASE_URL="postgresql://creditorflow:creditorflow123@localhost:5432/creditorflow?schema=public"

# Direct Database Connection (Migrations & Admin) - Schema-agnostic for Prisma engine
DIRECT_URL="postgresql://creditorflow:creditorflow123@localhost:5432/creditorflow"

# ------------------------------------------------------------------------------
# APPLICATION CONFIGURATION
# ------------------------------------------------------------------------------

NODE_ENV="development"
PORT=3001
NEXTAUTH_URL="http://localhost:3001"
APP_URL="http://localhost:3001"
APP_NAME="CreditorFlow EMS"
APP_VERSION="2.1.0"
APP_DESCRIPTION="Enterprise Invoice Management System"

# API Configuration
API_URL="http://localhost:3001/api"
API_VERSION="v1"
API_RATE_LIMIT=1000
API_RATE_LIMIT_WINDOW=900000

# Timezone & Locale (South African Compliance)
TIMEZONE="Africa/Johannesburg"
LOCALE="en-ZA"
CURRENCY="ZAR"
DATE_FORMAT="YYYY-MM-DD"
DATETIME_FORMAT="YYYY-MM-DD HH:mm:ss"

# ------------------------------------------------------------------------------
# AUTHENTICATION & SECURITY
# ------------------------------------------------------------------------------

# JWT Configuration (32+ character entropy enforced)
JWT_SECRET="creditorflow-jwt-secret-change-in-production-minimum-32-characters"
JWT_EXPIRES_IN="7d"
JWT_REFRESH_SECRET="creditorflow-refresh-secret-different-from-jwt-secret-64chars"
JWT_REFRESH_EXPIRES_IN="30d"
JWT_ALGORITHM="HS256"
JWT_ISSUER="creditorflow"
JWT_AUDIENCE="creditorflow-client"

# Session Configuration
SESSION_SECRET="creditorflow-session-secret-minimum-32-characters-long-secure"
SESSION_EXPIRES_IN="86400"
SESSION_SECURE=false
SESSION_SAME_SITE="lax"
SESSION_DOMAIN="localhost"

# Cookie Configuration
COOKIE_SECRET="creditorflow-cookie-secret-minimum-32-characters-long-secure"
COOKIE_SECURE=false
COOKIE_HTTP_ONLY=true
COOKIE_SAME_SITE="lax"

# Password Policy (POPIA-aligned)
PASSWORD_MIN_LENGTH=12
PASSWORD_MAX_LENGTH=128
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=true
PASSWORD_HISTORY_COUNT=5
PASSWORD_EXPIRY_DAYS=90

# Two-Factor Authentication (2FA)
TWO_FACTOR_ENABLED=false
TWO_FACTOR_ISSUER="CreditorFlow EMS"
TWO_FACTOR_ALGORITHM="SHA1"
TWO_FACTOR_DIGITS=6
TWO_FACTOR_STEP=30

# Encryption (Enable for POPIA compliance in production)
ENCRYPTION_KEY="creditorflow-encryption-key-32-bytes-minimum-required-here"
DATA_AT_REST_ENCRYPTION=false  # MUST be true in production

# ------------------------------------------------------------------------------
# EMAIL CONFIGURATION (SMTP)
# ------------------------------------------------------------------------------

SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER=""
SMTP_PASSWORD=""
SMTP_FROM="noreply@creditorflow.com"
SMTP_FROM_NAME="CreditorFlow EMS"
SMTP_SECURE=false
SMTP_TLS_REJECT_UNAUTHORIZED=false

# Email Templates
EMAIL_TEMPLATE_PATH="./templates/email"
EMAIL_ATTACHMENT_MAX_SIZE=10485760

# ------------------------------------------------------------------------------
# FILE UPLOAD CONFIGURATION
# ------------------------------------------------------------------------------

# Storage Provider (S3, AZURE_BLOB, GOOGLE_CLOUD, LOCAL, MINIO)
STORAGE_PROVIDER="LOCAL"
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE=26214400
ALLOWED_FILE_TYPES="pdf,jpg,jpeg,png,tiff,doc,docx,xls,xlsx,csv,xml"

# Local Storage Settings
LOCAL_STORAGE_PATH="./uploads"
LOCAL_STORAGE_URL="/uploads"

# AWS S3 Configuration (if STORAGE_PROVIDER=S3)
AWS_REGION="us-east-1"
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
AWS_S3_BUCKET="creditorflow-uploads"
AWS_S3_ENDPOINT=""
AWS_S3_FORCE_PATH_STYLE=false

# Azure Blob Configuration (if STORAGE_PROVIDER=AZURE_BLOB)
AZURE_STORAGE_ACCOUNT=""
AZURE_STORAGE_ACCESS_KEY=""
AZURE_STORAGE_CONTAINER="creditorflow-uploads"

# Google Cloud Storage (if STORAGE_PROVIDER=GOOGLE_CLOUD)
GOOGLE_CLOUD_PROJECT_ID=""
GOOGLE_CLOUD_KEY_FILE=""
GOOGLE_CLOUD_BUCKET="creditorflow-uploads"

# MinIO Configuration (if STORAGE_PROVIDER=MINIO)
MINIO_ENDPOINT="localhost"
MINIO_PORT=9000
MINIO_ACCESS_KEY="minioadmin"
MINIO_SECRET_KEY="minioadmin123"
MINIO_BUCKET="creditorflow-uploads"
MINIO_USE_SSL=false

# ------------------------------------------------------------------------------
# OCR & DOCUMENT PROCESSING
# ------------------------------------------------------------------------------

OCR_ENABLED=false
OCR_PROVIDER="TESSERACT" # TESSERACT, GOOGLE_VISION, AWS_TEXTRACT, AZURE_FORM_RECOGNIZER
OCR_LANGUAGE="eng"
OCR_DPI=300
OCR_TIMEOUT=30000
OCR_CONFIDENCE_THRESHOLD=80

# Tesseract Configuration
TESSERACT_PATH="/usr/bin/tesseract"
TESSDATA_PREFIX="/usr/share/tesseract-ocr/4.00/tessdata"

# Google Vision API
GOOGLE_VISION_API_KEY=""
GOOGLE_VISION_PROJECT_ID=""

# AWS Textract
AWS_TEXTRACT_REGION="us-east-1"
AWS_TEXTRACT_ACCESS_KEY_ID=""
AWS_TEXTRACT_SECRET_ACCESS_KEY=""

# ------------------------------------------------------------------------------
# AI & MACHINE LEARNING
# ------------------------------------------------------------------------------

# Fraud Detection
FRAUD_DETECTION_ENABLED=false
FRAUD_DETECTION_PROVIDER="LOCAL" # LOCAL, OPENAI, AZURE_ML
FRAUD_DETECTION_THRESHOLD=0.75
FRAUD_DETECTION_MODEL_PATH="./models/fraud-detection.pkl"

# Anomaly Detection
ANOMALY_DETECTION_ENABLED=false
ANOMALY_DETECTION_SENSITIVITY=0.05
ANOMALY_DETECTION_ALGORITHM="ISOLATION_FOREST"

# OpenAI Integration (for advanced features)
OPENAI_API_KEY=""
OPENAI_MODEL="gpt-4"
OPENAI_MAX_TOKENS=2000
OPENAI_TEMPERATURE=0.3

# ------------------------------------------------------------------------------
# NOTIFICATION CONFIGURATION
# ------------------------------------------------------------------------------

# Email Notifications
NOTIFICATION_EMAIL_ENABLED=true
NOTIFICATION_EMAIL_BATCH_SIZE=100
NOTIFICATION_EMAIL_RATE_LIMIT=50

# SMS Notifications
NOTIFICATION_SMS_ENABLED=false
SMS_PROVIDER="TWILIO" # TWILIO, CLICKATELL, AWS_SNS
SMS_FROM="CreditorFlow"
SMS_RATE_LIMIT=10

# Twilio Configuration
TWILIO_ACCOUNT_SID=""
TWILIO_AUTH_TOKEN=""
TWILIO_PHONE_NUMBER=""

# Slack Integration
SLACK_WEBHOOK_URL=""
SLACK_CHANNEL="#invoices"
SLACK_ENABLED=false

# Microsoft Teams
TEAMS_WEBHOOK_URL=""
TEAMS_ENABLED=false

# Push Notifications (Firebase)
FIREBASE_ENABLED=false
FIREBASE_SERVER_KEY=""
FIREBASE_PROJECT_ID=""

# ------------------------------------------------------------------------------
# WORKFLOW & SLA CONFIGURATION
# ------------------------------------------------------------------------------

# Default SLA Settings (hours) - SARS compliance aligned
DEFAULT_SLA_HOURS=48
URGENT_SLA_HOURS=24
CRITICAL_SLA_HOURS=4

# Approval Settings
APPROVAL_AUTO_ESCALATE=true
APPROVAL_ESCALATION_HOURS=24
APPROVAL_REMINDER_HOURS=12
APPROVAL_MAX_DELEGATION_DAYS=7

# Payment Settings
PAYMENT_BATCH_ENABLED=true
PAYMENT_BATCH_TIME="17:00"
PAYMENT_AUTO_PROCESS=false
PAYMENT_DEFAULT_METHOD="EFT"

# ------------------------------------------------------------------------------
# COMPLIANCE & AUDIT (POPIA/SOX Ready)
# ------------------------------------------------------------------------------

# Audit Log Retention (days)
AUDIT_LOG_RETENTION_DAYS=2555 # 7 years (SOX requirement)
AUDIT_LOG_ARCHIVE_ENABLED=true
AUDIT_LOG_ARCHIVE_PATH="./archives/audit"

# GDPR/POPIA Settings
GDPR_ENABLED=true  # POPIA equivalent enforcement
GDPR_DATA_RETENTION_DAYS=2555
GDPR_ANONYMIZATION_ENABLED=true

# SOX Compliance
SOX_COMPLIANCE_ENABLED=false
SOX_APPROVAL_SEGREGATION=true
SOX_AUDIT_TRAIL_IMMUTABLE=true

# Tax Settings (SARS Validated)
VAT_RATE=15.0
VAT_NUMBER_VALIDATION_ENABLED=true
TAX_ID_VALIDATION_ENABLED=true

# ------------------------------------------------------------------------------
# BACKUP & MAINTENANCE
# ------------------------------------------------------------------------------

# Automated Backups
BACKUP_ENABLED=false
BACKUP_SCHEDULE="0 2 * * *" # Daily at 2 AM SAST
BACKUP_RETENTION_DAYS=30
BACKUP_LOCATION="LOCAL" # LOCAL, S3, AZURE
BACKUP_PATH="./backups"

# Database Maintenance
DB_MAINTENANCE_SCHEDULE="0 3 * * 0" # Weekly on Sunday at 3 AM SAST
DB_VACUUM_ENABLED=true
DB_ANALYZE_ENABLED=true

# ------------------------------------------------------------------------------
# LOGGING & MONITORING
# ------------------------------------------------------------------------------

# Log Level (ERROR, WARN, INFO, DEBUG, TRACE)
LOG_LEVEL="info"
LOG_FORMAT="json" # json, simple, detailed
LOG_FILE="./logs/app.log"
LOG_MAX_SIZE=10485760
LOG_MAX_FILES=10

# Performance Monitoring
APM_ENABLED=false
APM_PROVIDER="JAEGER" # JAEGER, DATADOG, NEW_RELIC
APM_SERVICE_NAME="creditorflow-ems"
APM_ENDPOINT="http://localhost:14268/api/traces"

# Health Checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30000

# ------------------------------------------------------------------------------
# CACHE & PERFORMANCE
# ------------------------------------------------------------------------------

# Redis Cache
REDIS_ENABLED=true
REDIS_HOST="localhost"
REDIS_PORT=6379
REDIS_PASSWORD=""
REDIS_DB=0
REDIS_CACHE_TTL=3600

# In-Memory Cache
MEMORY_CACHE_ENABLED=true
MEMORY_CACHE_MAX_ITEMS=1000
MEMORY_CACHE_TTL=300

# ------------------------------------------------------------------------------
# INTEGRATION SETTINGS
# ------------------------------------------------------------------------------

# ERP Systems
SAP_ENABLED=false
SAP_HOST=""
SAP_USERNAME=""
SAP_PASSWORD=""
SAP_CLIENT=""

# Oracle NetSuite
NETSUITE_ENABLED=false
NETSUITE_ACCOUNT_ID=""
NETSUITE_CONSUMER_KEY=""
NETSUITE_CONSUMER_SECRET=""
NETSUITE_TOKEN_ID=""
NETSUITE_TOKEN_SECRET=""

# Xero
XERO_ENABLED=false
XERO_CLIENT_ID=""
XERO_CLIENT_SECRET=""
XERO_REDIRECT_URI="http://localhost:3001/api/integrations/xero/callback"

# QuickBooks
QUICKBOOKS_ENABLED=false
QUICKBOOKS_CLIENT_ID=""
QUICKBOOKS_CLIENT_SECRET=""
QUICKBOOKS_SANDBOX=true

# ------------------------------------------------------------------------------
# DEVELOPMENT & DEBUGGING
# ------------------------------------------------------------------------------

# Debug Mode
DEBUG=false
DEBUG_PRISMA=false
DEBUG_API=false
DEBUG_AUTH=false
DEBUG_WORKFLOW=false

# Seed Data
SEED_DATA_ENABLED=false
SEED_DATA_USERS=6
SEED_DATA_SUPPLIERS=10
SEED_DATA_INVOICES=50

# Hot Module Replacement
HMR_ENABLED=true

# TypeScript
TS_NODE_TRANSPILE_ONLY=true
TS_NODE_PROJECT="./tsconfig.json"

# ------------------------------------------------------------------------------
# SECURITY HEADERS & CORS
# ------------------------------------------------------------------------------

# CORS
CORS_ENABLED=true
CORS_ORIGIN="http://localhost:3000,http://localhost:3001"
CORS_METHODS="GET,POST,PUT,DELETE,PATCH,OPTIONS"
CORS_HEADERS="Content-Type,Authorization,X-Requested-With"
CORS_CREDENTIALS=true

# Security Headers
SECURITY_HEADERS_ENABLED=true
CONTENT_SECURITY_POLICY="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self'  https:; font-src 'self'; connect-src 'self' http://localhost:* https://localhost:*;"
X_FRAME_OPTIONS="DENY"
X_CONTENT_TYPE_OPTIONS="nosniff"
X_XSS_PROTECTION="1; mode=block"
STRICT_TRANSPORT_SECURITY="max-age=31536000; includeSubDomains"

# ------------------------------------------------------------------------------
# FEATURE FLAGS
# ------------------------------------------------------------------------------

FEATURE_BULK_OPERATIONS=true
FEATURE_ADVANCED_REPORTING=true
FEATURE_AI_ASSISTANT=false
FEATURE_BLOCKCHAIN_AUDIT=false
FEATURE_MOBILE_APP=false
FEATURE_MULTI_CURRENCY=true
FEATURE_MULTI_LANGUAGE=false
FEATURE_CUSTOM_WORKFLOWS=true
FEATURE_API_ACCESS=true
FEATURE_WEBHOOKS=true

# ==============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ==============================================================================
# [ ] Rotate ALL secrets using cryptographically secure generator
# [ ] Set NODE_ENV=production
# [ ] Enable DATA_AT_REST_ENCRYPTION=true
# [ ] Set SESSION_SECURE=true, COOKIE_SECURE=true
# [ ] Replace localhost bindings with FQDNs
# [ ] Configure TLS termination (HTTPS only)
# [ ] Enable STRICT_TRANSPORT_SECURITY in production
# [ ] Set up secret management (Vault/.env.vault)
# [ ] Remove default credentials (postgres/minio)
# [ ] Enable SOX_COMPLIANCE_ENABLED=true
# ==============================================================================